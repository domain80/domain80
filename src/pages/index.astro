---
import { getCollection } from "astro:content";
import BlogCard from "../components/blog/BlogCard.astro";
import ProjectCard from "../components/portfolio/ProjectCard.astro";
import HomeLayout from "../layouts/HomeLayout.astro";

// Get latest blog posts
const allPosts = await getCollection("blog");
const latestPosts = allPosts
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

// Get featured projects
const allProjects = await getCollection("projects");

// Get personal projects
const personalProjects = allProjects
  .filter((p) => p.data.featured && p.data.type === 'personal')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999))
  .slice(0, 3);

// Get work experience projects
const workProjects = allProjects
  .filter((p) => p.data.featured && p.data.type === 'work')
  .sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
---

<HomeLayout title="Home">
  <!-- Latest Posts Section -->
  <section id="whats-on-my-mind" class="mb-16 mt-46 scroll-mt-60">
    <div class="flex items-center justify-between mb-6 scroll-mt-40">
      <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100">
        Latest Posts
      </h2>
      <a
        href="/blog"
        class="text-sm text-zinc-600 dark:text-zinc-400 hover:text-accent dark:hover:text-accent transition-colors"
      >
        View all â†’
      </a>
    </div>
    <div class="space-y-4">
      {
        latestPosts.map((post) => (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            slug={post.id}
          />
        ))
      }
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="scroll-mt-48 mb-16">
    <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-6">
      Projects
    </h2>
    <div class="space-y-8">
      {
        personalProjects.map((project) => (
          <ProjectCard
            title={project.data.title}
            description={project.data.description}
            year={project.data.year}
            endYear={project.data.endYear}
            tags={project.data.tags}
            link={project.data.link}
            linkText={project.data.linkText}
            slug={project.id}
          />
        ))
      }
    </div>
  </section>

  <!-- Experience Section -->
  <section id="experience" class="scroll-mt-48">
    <h2 class="text-2xl font-bold text-zinc-900 dark:text-zinc-100 mb-6">
      Experience
    </h2>
    <div class="space-y-8">
      {
        workProjects.map((project) => (
          <ProjectCard
            title={project.data.title}
            description={project.data.description}
            year={project.data.year}
            endYear={project.data.endYear}
            tags={project.data.tags}
            link={project.data.link}
            linkText={project.data.linkText}
            slug={project.id}
          />
        ))
      }
    </div>
  </section>
</HomeLayout>
